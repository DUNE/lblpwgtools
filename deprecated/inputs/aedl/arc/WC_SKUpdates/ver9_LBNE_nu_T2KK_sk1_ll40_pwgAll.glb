%!GLoBES
$version="3.0.0"

/* 	 Beam data 	 */

nuflux(#lbne)<
  @flux_file="./WCINPUT/Fluxes/dusel120e250i002dr280dz_tgtz30_1300km_0kmoa_flux.txt"
  @time = NUTIME /* years */
  @power = (BEAMPOWER*(1.98e7)/(BEAMENERGY*1.6022e-10))/10e16  /* 10^20 POT per year (708kW,1.98e7s per yr,120GeV) */
  @norm = 1.0544e17 
>

$target_mass = 	        WCMASS


$emin =                 0.5
$emax =                 60.0
$binsize= {0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125,0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125,0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125,0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 4}


$sampling_min =                 0.5
$sampling_max =                 60.0
$sampling_stepsize= {0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125,0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125,0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125,0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 4}

/* 	 Baseline 	 */

$profiletype = 		1 
$baseline =             1300


/* 	 Technical information 	 */

$filter_state = 0 
$filter_value = 1000000 

/*       Energy Resolution       */
energy(#nc_pwg)<>
energy(#dis)<>

include "./WCINPUT/WCEffMod9/smear_nc_PWG.dat"
include "./WCINPUT/0524dis_ext2.dat"

energy(#signal)<>
include "./WCINPUT/0524signal_ext2.dat"




/* 	 Cross sections 	 */

cross(#NC)<
	@cross_file = "./WCINPUT/XSections/XNC.dat"
>

cross(#QE)<
	@cross_file = "./WCINPUT/XSections/XQE.dat"
>

cross(#CC)<
	@cross_file = "./WCINPUT/XSections/XCC.dat"
>

cross(#CCNonQE)<
	@cross_file = "./WCINPUT/XSections/XCCNonQE.dat"
>

/*Pre/Post Efficiencies Setup (now using Chelsea's interpolation setup)*/
%energy_pre = {0.0, 0.2, 0.4, 0.6, 0.8, 1.0, 1.2, 1.4, 1.6, 1.8, 2.0, 2.5, 3.0, 3.5, 4.0, 4.5, 5.0, 6.0, 7.0, 8.0, 9.0, 10.0, 15.0, 20.0, 40.0, 47.0}
%energy_post = {0.175, 0.6, 1.175, 1.75, 2.5, 3.5, 4.5, 7.5}
%sbc = samplingbincenter()
%bc = bincenter()
%pwg_bincenters = {0.5625,0.6875,0.8125,0.9375,1.0625,1.1875,1.3125,1.4375,1.5625,1.6875,1.8125,1.9375,2.0625,2.1875,2.3125,2.4375,2.5625,2.6875,2.8125,2.9375,3.0625,3.1875,3.3125,3.4375,3.5625,3.6875,3.8125,3.9375,4.0625,4.1875,4.3125,4.4375,4.5625,4.6875,4.8125,4.9375,5.0625,5.1875,5.3125,5.4375,5.5625,5.6875,5.8125,5.9375,6.0625,6.1875,6.3125,6.4375,6.5625,6.6875,6.8125,6.9375,7.0625,7.1875,7.3125,7.4375,7.5625,7.6875,7.8125,7.9375,9,11,13,15,17,19,21,23,25,27,29,31,33,35,37,39,41,43,45,47,49,51,53,55,58,70}

%pwg_Signalprecuts = {0.738443,0.73972,0.724838,0.693795,0.662877,0.631586,0.594937,0.551748,0.509244,0.466054,0.437556,0.422832,0.408341,0.393617,0.379127,0.364402,0.353679,0.34661,0.339654,0.332585,0.325629,0.31856,0.311604,0.304536,0.297579,0.290511,0.283554,0.276486,0.273008,0.273008,0.273008,0.273008,0.273008,0.273008,0.273008,0.273008,0.273008,0.273008,0.273008,0.273008,0.273008,0.273008,0.273008,0.273008,0.273008,0.273008,0.273008,0.273008,0.273008,0.273008,0.273008,0.273008,0.273008,0.273008,0.273008,0.273008,0.273008,0.273008,0.273008,0.273008,0.273008,0.273008,0.273008,0.273008,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0}
%pwg_Signalpostcuts = {0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0}

%pwg_ncpostcuts = {0.03873,0.05061,0.05940,0.06511,0.07081,0.07651,0.07549,0.06773,0.05998,0.05222,0.05298,0.06225,0.07153,0.08080,0.09007,0.09935,0.10332,0.10198,0.10064,0.09930,0.07837,0.07730,0.07623,0.07516,0.07409,0.07302,0.07195,0.07088,0.07035,0.07035,0.07035,0.07035,0.07035,0.07035,0.07035,0.07035,0.07035,0.07035,0.07035,0.07035,0.07035,0.07035,0.07035,0.07035,0.07035,0.07035,0.07035,0.07035,0.07035,0.07035,0.07035,0.07035,0.07035,0.07035,0.07035,0.07035,0.07035,0.07035,0.07035,0.07035,0.07035,0.07035,0.07035,0.07035,0.07035,0.07035,0.00000,0.00000,0.00000,0.00000,0.00000,0.00000,0.00000,0.00000,0.00000,0.00000,0.00000,0.00000,0.00000,0.00000,0.00000,0.00000,0.00000,0.00000,0.00000,0.00000}
%pwg_ncprecuts = {0.0377,0.0409,0.0441,0.0473,0.0504,0.0536,0.0567,0.0599,0.0647,0.0684,0.0716,0.0745,0.0771,0.0794,0.0815,0.0834,0.0851,0.0866,0.0879,0.0892,0.0903,0.0913,0.0922,0.0930,0.0937,0.0944,0.0950,0.0955,0.0960,0.0964,0.0968,0.0971,0.0974,0.0976,0.0978,0.0980,0.0981,0.0982,0.0983,0.0984,0.0984,0.0984,0.0984,0.0983,0.0983,0.0982,0.0981,0.0980,0.0979,0.0978,0.0976,0.0975,0.0973,0.0971,0.0969,0.0967,0.0965,0.0963,0.0960,0.0958,0.0935,0.0885,0.0831,0.0776,0.0723,0.0672,0.0623,0.0578,0.0535,0.0495,0.0458,0.0424,0.0392,0.0362,0.0335,0.0309,0.0286,0.0264,0.0244,0.0225,0.0208,0.0192,0.0177,0.0163,0.0151,0.0139}

%pwg_numuprecuts = {0.00338787,0.00407421,0.00479874,0.00556145,0.00632112,0.00708993,0.00749099,0.00753724,0.00758275,0.00762899,0.00776012,0.00798038,0.00819713,0.00841739,0.00863414,0.0088544,0.00877713,0.00839984,0.00802855,0.00765126,0.00727997,0.00690268,0.00653138,0.0061541,0.0057828,0.00540552,0.00503422,0.00465694,0.00447129,0.00447129,0.00447129,0.00447129,0.00447129,0.00447129,0.00447129,0.00447129,0.00447129,0.00447129,0.00447129,0.00447129,0.00447129,0.00447129,0.00447129,0.00447129,0.00447129,0.00447129,0.00447129,0.00447129,0.00447129,0.00447129,0.00447129,0.00447129,0.00447129,0.00447129,0.00447129,0.00447129,0.00447129,0.00447129,0.00447129,0.00447129,0.00447129,0.00447129,0.00447129,0.00447129,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0}
%pwg_numupostcuts = {0.110534,0.127482,0.126799,0.108486,0.0902455,0.0717857,0.0648452,0.0692002,0.0734861,0.0778411,0.078782,0.0763392,0.0739352,0.0714924,0.0690884,0.0666456,0.0636436,0.0599856,0.0563857,0.0527277,0.0491278,0.0454698,0.0418699,0.0382119,0.034612,0.030954,0.027354,0.0236961,0.0218961,0.0218961,0.0218961,0.0218961,0.0218961,0.0218961,0.0218961,0.0218961,0.0218961,0.0218961,0.0218961,0.0218961,0.0218961,0.0218961,0.0218961,0.0218961,0.0218961,0.0218961,0.0218961,0.0218961,0.0218961,0.0218961,0.0218961,0.0218961,0.0218961,0.0218961,0.0218961,0.0218961,0.0218961,0.0218961,0.0218961,0.0218961,0.0218961,0.0218961,0.0218961,0.0218961,0.0218961,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0}


/*INTERPOLATIONS*/
%precuts_NUE_CC = interpolation(%pwg_bincenters,%pwg_Signalprecuts,1,%sbc)
%precuts_NC = interpolation(%pwg_bincenters,%pwg_ncprecuts,1,%sbc)
%precuts_numuCC = interpolation(%pwg_bincenters,%pwg_numuprecuts,1,%sbc)

%likelihood_NUE_CC = interpolation(%pwg_bincenters,%pwg_Signalpostcuts,1,%bc)
%likelihood_numuCC = interpolation(%pwg_bincenters,%pwg_numupostcuts,1,%bc)
%likelihood_NC = interpolation(%pwg_bincenters,%pwg_ncpostcuts,1,%bc)


/*Channels*/
channel(#nc_bg)<
	@channel = 	#lbne:	+:	m:	NOSC_m:	#NC:    #nc_pwg							
	@pre_smearing_efficiencies = copy(%precuts_NC)
	@post_smearing_efficiencies = copy(%likelihood_NC)
>

channel(#nu_mu_bg)<
	@channel = 	#lbne:	+:	m:	m:	#CC:    #dis	
	@pre_smearing_efficiencies = copy(%precuts_numuCC)
	@post_smearing_efficiencies = copy(%likelihood_numuCC)
>

channel(#nu_e_beam_qe)<
	@channel = 	#lbne:	+:	e:	e:	#QE:    #signal
	@pre_smearing_efficiencies = copy(%precuts_NUE_CC)
	@post_smearing_efficiencies = copy(%likelihood_NUE_CC)
>

channel(#nu_e_beam_nqe)<
	@channel = 	#lbne:	+:	e:	e:	#CCNonQE:    #signal
	@pre_smearing_efficiencies = copy(%precuts_NUE_CC)
	@post_smearing_efficiencies = copy(%likelihood_NUE_CC)
>

channel(#nu_e_signal_nqe)<
	@channel = 	#lbne:	+:	m:	e:	#CCNonQE:    #signal	
	@pre_smearing_efficiencies = copy(%precuts_NUE_CC)
	@post_smearing_efficiencies = copy(%likelihood_NUE_CC)
>
channel(#nu_e_signal_qe)<
	@channel = 	#lbne:	+:	m:	e:	#QE:    #signal	
	@pre_smearing_efficiencies = copy(%precuts_NUE_CC)
	@post_smearing_efficiencies = copy(%likelihood_NUE_CC)
>

/* 	 Rules 		  */

rule(#nu_e_appearance)<
 	@signal = 1.0@#nu_e_signal_qe : 1.0@#nu_e_signal_nqe
	@background =  1.0@#nu_mu_bg : 1.0@#nc_bg : 1.0@#nu_e_beam_qe : 1.0@#nu_e_beam_nqe   
	/*@signalerror = 0.01 : 0.0001
	@backgrounderror = 0.05 : 0.0001
	@backgroundcenter = 1.0 : 0.0
	@errordim_sys_on = 0
	@errordim_sys_off = 2*/

	/*use custom error function for outputting more parameters*/
	@sys_on_function="chiSpectrumTiltCustom"
	@sys_on_errors={0.01, 0.0001, 0.05, 0.0001}
	@sys_off_function = "chiNoSysSpectrum"
>

/**********************END**********************/
