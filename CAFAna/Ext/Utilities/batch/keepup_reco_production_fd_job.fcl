#include "services.fcl"

#include "CalHit.fcl"
#include "Slicer4D.fcl"

#include "CosmicExposureInfo.fcl"
#include "IFDBSpillInfo.fcl"

#include "CosmicTrack.fcl"
#include "CosmicVeto.fcl"

#include "KalmanTrack.fcl"
#include "KalmanTrackMerge.fcl"

#include "MultiHoughT.fcl"
#include "ElasticArmsHS.fcl"
#include "FuzzyKVertex.fcl"

#include "MichelEFilter.fcl"
#include "SliceMEF.fcl"
#include "FillNueSandbox.fcl"
#include "FillSandbox.fcl"
#include "CAFMaker.fcl"
#include "CosRej.fcl"

#include "BackTracker.fcl"

#include "Metadata.fcl"

process_name: KeepupReco

services:
{
  TFileService: { fileName: "recoproduction_hist.root" closeFileFast: false}
  scheduler:    { wantTracer: true wantSummary: true }
  message:      { debugModules: ["*"] destinations: { debugmsg:{type: "cout" threshold: "WARNING"} } }
  @table::standard_services
}
services.BackTracker: @local::standard_backtracker
services.IFBeam: {}

source:
{
  module_type: RootInput
  maxEvents:   -1
}

outputs:
{
  out1:
  {
    module_type: RootOutput
    fileName:    "keepuprecoproduction_r%r_s%s.root"
    fastCloning: false
    outputCommands: [ "keep * ",
                      "drop *_nuesand_*_KeepupReco",
                      "drop *_numusand_*_KeepupReco"
                    ]    
  }
}

physics:
{
  producers:
  {
    #responsibility indicated in comments after each module
    exposure:             @local::standard_cosmicexposureinfo  #calib
    ifdbspillinfo:        @local::standard_ifdbspillinfo       #beam
    calhit:               @local::standard_calhit              #calib
    slicer:               @local::standard_slicer4d            #reco
    cosmictrack:          @local::standard_cosmictrack         #reco
    veto:                 @local::standard_cosmicveto          #prod
    kalmantrack:          @local::standard_kalmantrack         #reco
    kalmantrackmerge:     @local::standard_kalmantrackmerge    #reco
    multihough:           @local::standard_multihough          #reco
    elasticarmshs:        @local::standard_elasticarmshs       #reco
    fuzzykvertex:         @local::standard_fuzzykvertex        #reco
    slicemef:             @local::standard_slicemef            #reco
    cosrej:               @local::standard_cosrej
    nuesand:              @local::standard_nuesand
    numusand:             @local::standard_numusand
    cafmaker:             @local::blinded_cafmaker
    restrictedcaf:        @local::standard_cafmaker
  }

  analyzers:
  {
    metadata:             @local::standard_metadata            #prod
  }

  filters:
  {
    michelecosmictrack:   @local::passall_michelecosmic        #calib
    michelekalmantrack:   @local::passall_michelekalman        #calib
  }
    
  reco: [ exposure, ifdbspillinfo, calhit, slicer, cosmictrack, veto, kalmantrack,
          kalmantrackmerge, multihough, elasticarmshs, fuzzykvertex,
          michelecosmictrack, michelekalmantrack, slicemef, cosrej, nuesand, numusand, cafmaker, restrictedcaf ]
    
  stream1:       [ out1, metadata ]
  trigger_paths: [ reco ]
  end_paths:     [ stream1 ]
}

physics.analyzers.metadata.params.Reconstructed.base_release: "" #automatically picked up at run time
physics.analyzers.metadata.params.NOVA.Standard: "true"
physics.analyzers.metadata.params.NOVA.Special: "keepup"

physics.producers.cosrej.UseLongestTrack: true
