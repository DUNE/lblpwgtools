#include "services.fcl"
#include "BackTracker.fcl"  
#include "Metadata.fcl"

# numue/remid (includes RecoMuonConfig.fcl itself)
#include "NumuEnergy.fcl"
#include "ReMIdValidate.fcl"
#include "NumuEAna.fcl"

# qepid
#include "QeFinder.fcl"
#include "QeFinderVal.fcl"

# cosrej
#include "CosRej.fcl"

# eid
#include "RecoJMShower.fcl"  
#include "NueSel.fcl"

# rvp
#include "RecVarPID.fcl"

# slid 
#include "Recluster.fcl"
#include "LIDBuilder.fcl"

# lem
#include "LEMSummarizer.fcl"

# nue preselection
#include "NuePresel.fcl"

process_name: BatchPID

services:
{
  # Load the service that manages root files for histograms.
  TFileService: { fileName: "nuesel_swap_fd_hist.root" closeFileFast: false }
  scheduler:    { wantTracer: true wantSummary: true }
  message:      { debugModules: ["*"] destinations: { debugmsg:{type: "cout" threshold: "WARNING"} } }
  @table::standard_services
}
services.BackTracker: @local::standard_backtracker

source:
{
  module_type: RootInput
  maxEvents:   -1
}

outputs:
{
  out1:
  {
    module_type: RootOutput
    fileName:    "nuesel_swap_fd_reco.root" #default file name, can override from command line with -o or --output
    fastCloning: false
  }
  out2:
  {
    module_type: RootOutput
    fileName:    "summarized.root"
    outputCommands: [ "drop *",
                      "keep lem::LEMInputs_*_*_*",
                      "keep sumdata::*_*_*_*"
                    ]
  }
}

physics:
{
  producers:
  {
    #responsibility indicated in comments after each module    
    remid:              @local::standard_recomuon            #numu
    cosrej:             @local::standard_cosrej              #numu
    numue:              @local::standard_numue               #numu
    qepid:              @local::standard_qefinder            #numu
    
    nuepresel:          @local::nue_prodpresel
    recojmshower:       @local::standard_recojmshower        #nue
    eid:                @local::standard_nuesel              #nue
    recluster:          @local::standard_recluster           #nue
    slid:               @local::standard_lidbuilder          #nue
    rvp:                @local::standard_rvp                 #nue    
    summarize:          @local::standard_lemsummarizer       #nue
  }

  analyzers:
  {
    remidana:           @local::standard_remidvalidate       #numu
    numueana:           @local::standard_numueana            #numu
    qepidana:           @local::standard_qefinderval         #numu
    metadata:           @local::standard_metadata
  }

  reco:          [ remid, cosrej, numue, qepid,
                   nuepresel,
                   recojmshower, eid, recluster, slid, rvp, summarize ]
  ana:           [ remidana, numueana, qepidana ]
    
  stream1:       [ out1, out2, metadata ]
  trigger_paths: [ reco, lemsum ]
  end_paths:     [ ana, stream1 ]
}

physics.analyzers.metadata.params.pidpart.base_release: ""       #automatically picked up at run time
physics.analyzers.metadata.params.NOVA.Standard: "true"
