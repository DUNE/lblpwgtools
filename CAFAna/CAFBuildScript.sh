#!/bin/bash
yum install -y --setopt=tsflags=nodocs svn which make redhat-lsb-core glibc-devel automake libtool && yum clean all;cd /opt;source /cvmfs/dune.opensciencegrid.org/products/dune/setup_dune.sh;if ! git clone https://github.com/DUNE/lblpwgtools.git lblpwgtools; then exit 1; fi;cd lblpwgtools;git checkout strong_and_less_stable;cd code/CAFAna/CAFAna;./standalone_configure_and_build.sh -j 8 -u -r -I /opt/CAFAna/; cat /build_scripts/CAFEnvWrapper.sh > /opt/CAFAna/CAFEnvWrapper.sh; chmod -R 775 /opt/CAFAna; if [ "0" == "1" ]; then ./standalone_configure_and_build.sh -f -j 8 --knl -u -r -I /opt/CAFAna_knl/; cat /build_scripts/CAFEnvWrapper_knl.sh > /opt/CAFAna_knl/CAFEnvWrapper.sh; chmod -R 775 /opt/CAFAna_knl; fi; if [ "1" == "1" ]; then rm -rf /opt/lblpwgtools; fi; if [ -e /statefiles_in ]; then cp -r /statefiles_in /statefiles; chmod -R 744 /statefiles; fi
