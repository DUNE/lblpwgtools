#include "services.fcl"
#include "BackTracker.fcl"
#include "Metadata.fcl"

#include "QeFinder.fcl"
#include "NumuEnergy.fcl"

#include "CosRej.fcl"

#include "NuePresel.fcl"

#include "RecVarPID.fcl"

#include "Recluster.fcl"
#include "LIDBuilder.fcl"

#include "MakeNueCosRej.fcl"

#include "LEMSummarizer.fcl"

#include "LEMPresel.fcl"

process_name: BatchMRPID

services:
{
  TFileService: { fileName: "muon_remove_hist.root" closeFileFast: false }
  scheduler:    { wantTracer: true wantSummary: true }
  message:      { debugModules: ["*"] destinations: { debugmsg:{type: "cout" threshold: "WARNING"} } }
  @table::standard_services
}
services.BackTracker:  @local::standard_backtracker    

source:
{
  module_type: RootInput
  maxEvents:  -1
}

outputs:
{
  out1:
  {
    module_type: RootOutput
    fileName:    "muon_remove_pid.root"
    fastCloning: false
  }

  out2:
  {
    module_type: RootOutput
    fileName:    "summarized.root"
    outputCommands: [ "drop *",
                      "keep lem::LEMInputs_*_*_*",
                      "keep sumdata::*_*_*_*"
                    ]
  }
}

# The muon removed digits have module label "mrcc". 
physics:
{
  producers:
  {
    ######################### NUMU PID ##############################
      
    remidmrcc:         @local::mrcc_recomuon
    cosrejmrcc:        @local::mrcc_cosrej
    numuemrcc:         @local::mrcc_numue
    qepidmrcc:         @local::mrcc_qefinder

    ######################### NUE PID ###############################

    nuepreselmrcc:     @local::mrcc_nue_prodpresel
    reclustermrcc:     @local::mrcc_recluster
    slidmrcc:          @local::mrcc_lidbuilder
    nuecosrejmrcc:     @local::mrcc_nuecosrej  
    rvpmrcc:           @local::mrcc_rvp
    lempreselmrcc:     @local::mrcc_lempresel
    summarizemrcc:     @local::mrcc_lemsummarizer
  }

  analyzers:
  {
    metadata:           @local::standard_metadata
  }

  jobs: [ remidmrcc, 
          cosrejmrcc,
          numuemrcc,
          qepidmrcc,
          nuepreselmrcc, 
          reclustermrcc,
          slidmrcc,
          nuecosrejmrcc,
          rvpmrcc,
          lempreselmrcc,    
          summarizemrcc
        ] 
    
  stream1:       [ out1, out2, metadata ]
  trigger_paths: [ jobs ]
  end_paths:     [ stream1 ]
}

physics.analyzers.metadata.params.mrccpidpart.base_release: ""
physics.analyzers.metadata.params.NOVA.Standard: "true"
